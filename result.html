<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Results</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="styles.css">
    <script src="script.js" defer></script>
  </head>
  <body
    class="font-serif text-purple-300 min-h-screen bg-gray-900 flex flex-col opacity-0 transition-opacity duration-500 ease-in-out"
    onload="fadeInPage()"
  >
    <ul class="squares">
      <li></li>
      <li></li>
      <li></li>
      <li></li>
      <li></li>
      <li></li>
      <li></li>
      <li></li>
      <li></li>
      <li></li>
    </ul>

    <div id="layout-placeholder"></div>

    <main class="flex justify-center items-start mt-10 w-full px-4 relative z-10">
      <div
        id="review-container"
        class="hidden fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50"
      >
        <div class="bg-gray-900 text-purple-300 p-6 rounded-lg shadow-lg w-96 max-h-[400px] overflow-y-auto relative">
          <button id="close-review" class="absolute top-2 right-2 text-purple-300 hover:text-red-500 text-xl">✖</button>
          <h2 class="text-xl font-bold mb-3">Review Your Answers</h2>
          <ul id="review-list" class="space-y-2"></ul>
        </div>
      </div>

      <div class="w-3/4 flex justify-center">
        <div class="max-w-lg bg-gray-800 bg-opacity-50 p-6 shadow-lg rounded-lg text-center">
          <h1 class="text-4xl font-bold mb-4 text-purple-500">Quiz Results</h1>
          <p class="text-xl text-purple-400">Well done, <span id="player-name"></span>!</p>
          <p class="text-lg text-purple-400">Your Score: <span id="final-score">0</span>/10</p>

          <div
            id="leaderboard-container"
            class="hidden fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50"
          >
            <div class="bg-gray-900 text-purple-300 p-6 rounded-lg shadow-lg w-96 max-h-[400px] overflow-y-auto relative">
              <button id="close-leaderboard" class="absolute top-2 right-2 text-purple-300 hover:text-red-500 text-xl">✖</button>
              <h2 class="text-xl font-bold mb-3">Leaderboard</h2>
              <ul id="leaderboard" class="space-y-2"></ul>
              <button id="clear-leaderboard-btn" class="mt-6 bg-red-500 text-white px-6 py-3 rounded-lg text-lg shadow-md hover:bg-red-600">Clear Leaderboard</button>
            </div>
          </div>

          <button id="review-btn" class="mt-4 sm:mt-6 bg-gradient-to-b from-[#3a2d5a] to-[#221a35] text-white px-4 py-2 sm:px-6 sm:py-3 rounded-lg text-base sm:text-lg shadow-lg border border-[#464b63] hover:from-[#3b3f52] hover:to-[#232530] hover:border-[#5a5f7a] transition-all w-full sm:w-auto">
            Review Answers
          </button>
          
          <button id="leaderboard-btn" class="mt-4 sm:mt-6 bg-gradient-to-b from-[#3a2d5a] to-[#221a35] text-white px-4 py-2 sm:px-6 sm:py-3 rounded-lg text-base sm:text-lg shadow-lg border border-[#464b63] hover:from-[#3b3f52] hover:to-[#232530] hover:border-[#5a5f7a] transition-all w-full sm:w-auto">
            View Leaderboard
          </button>
          
          <a href="quiz.html" class="mt-4 sm:mt-6 inline-block bg-gradient-to-b from-[#3a2d5a] to-[#221a35] text-white px-4 py-2 sm:px-6 sm:py-3 rounded-lg text-base sm:text-lg shadow-lg border border-[#464b63] hover:from-[#3b3f52] hover:to-[#232530] hover:border-[#5a5f7a] transition-all w-full sm:w-auto">
            Try Again
          </a>
          
          
          
          
        </div>
      </div>
    </main>

    <script>
      async function loadLayout() {
        try {
          const response = await fetch("layout.html");
          const text = await response.text();
          document.getElementById("layout-placeholder").innerHTML = text;
        } catch (error) {
          console.error("Error loading layout:", error);
        }
      }
      loadLayout();

      document.addEventListener("DOMContentLoaded", function () {
        const username = localStorage.getItem("username") || "Guest";
        const score = localStorage.getItem("score") || 0;
        const reviewData = JSON.parse(localStorage.getItem("reviewData")) || [];
        document.getElementById("player-name").textContent = username;
        document.getElementById("final-score").textContent = score;

        let leaderboard = JSON.parse(localStorage.getItem("leaderboard")) || [];
        leaderboard.push({ name: username, score: parseInt(score) });
        leaderboard.sort((a, b) => b.score - a.score);
        localStorage.setItem("leaderboard", JSON.stringify(leaderboard));

        const leaderboardList = document.getElementById("leaderboard");
        const clearLeaderboardBtn = document.getElementById("clear-leaderboard-btn");

        if (leaderboard.length > 0) {
          clearLeaderboardBtn.classList.remove("hidden");
        }

        leaderboardList.innerHTML = "";
        leaderboard.forEach((entry) => {
          const li = document.createElement("li");
          li.textContent = `${entry.name}: ${entry.score}/10`;
          li.classList.add("bg-gray-800", "p-2", "rounded");
          leaderboardList.appendChild(li);
        });

        document.getElementById("review-btn").addEventListener("click", function () {
          document.getElementById("review-container").classList.remove("hidden");
          document.getElementById("review-list").innerHTML = "";
          reviewData.forEach((item, index) => {
            const li = document.createElement("li");
            li.innerHTML = `<strong>Q${index + 1}:</strong> ${item.question} <br>
                            <span class="text-gray-500">Your Answer: <span class="${item.correct ? "text-green-500" : "text-red-500"}">${item.selected}</span></span> <br>
                            <span class="text-blue-500">Correct Answer: ${item.correctAnswer}</span>`;
            li.classList.add("bg-gray-800", "p-2", "rounded");
            document.getElementById("review-list").appendChild(li);
          });
        });

        document.getElementById("close-review").addEventListener("click", function () {
          document.getElementById("review-container").classList.add("hidden");
        });

        document.getElementById("leaderboard-btn").addEventListener("click", function () {
          document.getElementById("leaderboard-container").classList.remove("hidden");
        });

        document.getElementById("close-leaderboard").addEventListener("click", function () {
          document.getElementById("leaderboard-container").classList.add("hidden");
        });

        document.getElementById("clear-leaderboard-btn").addEventListener("click", function () {
          if (confirm("Are you sure you want to clear the leaderboard?")) {
            localStorage.removeItem("leaderboard");
            document.getElementById("leaderboard").innerHTML = "";
            alert("Leaderboard cleared!");
          }
        });
      });
    </script>
  </body>
</html>
